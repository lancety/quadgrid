(()=>{"use strict";function e(e,t){return{bound:e,level:t,nodes:[]}}const t=1200,n=1e3;let o=0,s=Math.min(t,n);for(;s>2;)s/=2,o++;const r=new class{constructor(t,n,o=6,s=10){this.width=t,this.height=n,this.cellDepthMax=o,this.cellItemsMax=s,this.cellMinSize=Math.min(t,n)/Math.pow(2,o),this.root=e([t/2,n/2,t/2,n/2],0)}split(t){const n=t.level+1,o=t.bound[0],s=t.bound[1],r=t.bound[2]/2,d=t.bound[3]/2;t.nodes.push(e([o-r,s-d,r,d],n),e([o+r,s-d,r,d],n),e([o+r,s+d,r,d],n),e([o-r,s+d,r,d],n))}getIndex(e,t){let n=0,o=e.bound[0],s=e.bound[1];const r=t[1]-t[3]<s,d=t[0]-t[2]<o,i=t[0]+t[2]>o,l=t[1]+t[3]>s;return d&&r&&(n|=1),r&&i&&(n|=2),i&&l&&(n|=4),d&&l&&(n|=8),n}merge(e){e.nodes.splice(0)}inside(e,t){return e[0]-e[2]>t[0]-t[2]&&e[1]-e[3]>t[1]-t[3]&&e[0]+e[2]<t[0]+t[2]&&e[1]+e[3]<t[1]+t[3]}insertBatch(e,t,n){const o=this.getIndex(e,t);1&o&&this[n](e.nodes[0],t),2&o&&this[n](e.nodes[1],t),4&o&&this[n](e.nodes[2],t),8&o&&this[n](e.nodes[3],t)}insert(e,t){!0===this.inside(e.bound,t)?!0!==e.covered&&(this.merge(e),e.taken=!0,e.covered=!0):(e.level<this.cellDepthMax&&!e.covered&&!e.nodes.length&&this.split(e),e.nodes.length&&this.insertBatch(e,t,"insert"),0===e.nodes.length?e.taken=!0:delete e.taken)}allNodes(e,t){return t.nodes.length>0?t.nodes.forEach((t=>{this.allNodes(e,t)})):e.push(t),e}}(t,n,o,2),d={rects:[]},i=document.getElementById("canvas");i.setAttribute("width","1200"),i.setAttribute("height","1000"),i.style.background="#111";const l=i.getContext("2d");function c(e,t){return Math.round(e+Math.random()*(t-e))}function h(e){e.nodes.length?e.nodes.forEach((e=>h(e))):e.taken||(l.strokeStyle="rgba(0, 255, 0, 0.4)",l.strokeRect(...g(e.bound)))}function a(e){e.nodes.length?e.nodes.forEach((e=>a(e))):e.taken&&(l.fillStyle="rgba(6, 6, 6, 0.8)",l.fillRect(...g(e.bound)))}function u(e){e.nodes.length?e.nodes.forEach((e=>u(e))):e.taken&&(l.strokeStyle="rgba(152,11,11,0.8)",l.strokeRect(...g(e.bound)))}function g(e){return[e[0]-e[2],e[1]-e[3],2*e[2],2*e[3]]}!function e(){l.clearRect(0,0,t,n),document.getElementById("info_count").innerText=d.rects.length+"",h(r.root),a(r.root),u(r.root),window.requestAnimationFrame(e)}(),window.addNodes=function(e,o=!1){const s=Math.ceil(Math.sqrt(e)),i=Array(s).fill(null);i.forEach(((r,l)=>{i.forEach(((r,i)=>{const h=c(2,10)*(o||e>=10&&l<.2*s?20:1)/2,a=c(2,10)*(o||e>=10&&i<.2*s?20:1)/2;d.rects.push([c(h,t-h),c(a,n-a),h,a])}))}));const l=performance.now();for(let e=0;e<d.rects.length;e++)r.insert(r.root,d.rects[e]);const h=performance.now();console.log(`add ${e} duration`,h-l),console.log("allNodes",r.allNodes([],r.root))}})();
//# sourceMappingURL=demo.bundle.js.map
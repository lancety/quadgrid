(()=>{"use strict";const e=1200,t=1e3;let n=0,s=Math.min(e,t);for(;s>2;)s/=2,n++;const o=new class{constructor(e,t,n=6){this.width=e,this.height=t,this.cellDepthMax=n,this.cellBatchSize=1e5,this.nodeAnchor=0,this.cellMinSize=Math.min(e,t)/Math.pow(2,n),this.nodeBounds=new Float32Array(4*this.cellBatchSize),this.nodesRef=new Int32Array(4*this.cellBatchSize),this.nodesLevel=new Int8Array(this.cellBatchSize),this.nodesCovered=new Int8Array(this.cellBatchSize),this.nodesTaken=new Int8Array(this.cellBatchSize),this.newNode(e/2,t/2,e/2,t/2,0)}newNode(e,t,n,s,o){const i=4*this.nodeAnchor;this.nodeBounds[i]=e,this.nodeBounds[i+1]=t,this.nodeBounds[i+2]=n,this.nodeBounds[i+3]=s,this.nodesLevel[this.nodeAnchor]=o;const d=this.nodeAnchor;return this.nodeAnchor++,d}split(e){const t=4*e,n=this.nodesLevel[e]+1,s=this.nodeBounds[t],o=this.nodeBounds[t+1],i=this.nodeBounds[t+2]/2,d=this.nodeBounds[t+3]/2;this.nodesRef.set([this.newNode(s-i,o-d,i,d,n),this.newNode(s+i,o-d,i,d,n),this.newNode(s+i,o+d,i,d,n),this.newNode(s-i,o+d,i,d,n)],t)}getIndex(e,t){let n=0,s=this.nodeBounds[e],o=this.nodeBounds[e+1];const i=t[1]-t[3]<o,d=t[0]-t[2]<s,h=t[0]+t[2]>s,r=t[1]+t[3]>o;return d&&i&&(n|=1),i&&h&&(n|=2),h&&r&&(n|=4),d&&r&&(n|=8),n}merge(e){this.nodesRef.set([0,0,0,0],e)}inside(e,t){const n=this.nodeBounds[e]-t[0],s=this.nodeBounds[e+1]-t[1],o=this.nodeBounds[e+2]-t[2],i=this.nodeBounds[e+3]-t[3];return o<=0&&i<=0&&n-o>=0&&s-i>=0&&n+o<=0&&s+i<=0}insertBatch(e,t,n){const s=this.getIndex(e,t);1&s&&this[n](this.nodesRef[e],t),2&s&&this[n](this.nodesRef[e+1],t),4&s&&this[n](this.nodesRef[e+2],t),8&s&&this[n](this.nodesRef[e+3],t)}insert(e,t){const n=4*e;!0===this.inside(n,t)?1!==this.nodesCovered[e]&&(this.merge(n),this.nodesTaken[e]=1,this.nodesCovered[e]=1):(this.nodesLevel[e]<this.cellDepthMax&&!this.nodesCovered[e]&&!this.nodesRef[n]&&this.split(e),this.nodesRef[n]&&this.insertBatch(n,t,"insert"),0===this.nodesRef[n]?this.nodesTaken[e]=1:this.nodesTaken[e]=0)}}(e,t,n),i={rects:[]},d=document.getElementById("canvas");d.setAttribute("width","1200"),d.setAttribute("height","1000"),d.style.background="#111";const h=d.getContext("2d");function r(e,t){return Math.round(e+Math.random()*(t-e))}function c(e){if(0===e)return;const t=4*(e||0);if(o.nodesRef[t])for(let e=0;e<4;e++)c(o.nodesRef[t+e]);else o.nodesTaken[e]||(h.strokeStyle="rgba(0, 255, 0, 0.4)",h.strokeRect(...u(o.nodeBounds.subarray(t,t+4))))}function l(e){if(0===e)return;const t=4*(e||0);if(o.nodesRef[t])for(let e=0;e<4;e++)l(o.nodesRef[t+e]);else o.nodesTaken[e]&&(h.fillStyle="rgba(6, 6, 6, 0.8)",h.strokeRect(...u(o.nodeBounds.subarray(t,t+4))))}function a(e){if(0===e)return;const t=4*(e||0);if(o.nodesRef[t])for(let e=0;e<4;e++)a(o.nodesRef[t+e]);else o.nodesTaken[e]&&(h.strokeStyle="rgba(152,11,11,0.8)",h.strokeRect(...u(o.nodeBounds.subarray(t,t+4))))}function u(e){return[e[0]-e[2],e[1]-e[3],2*e[2],2*e[3]]}!function n(){1!==o.nodeAnchor&&(h.clearRect(0,0,e,t),document.getElementById("info_count").innerText=i.rects.length+"",c(),l(),a()),window.requestAnimationFrame(n)}(),window.addNodes=function(n,s=!1){const d=Math.ceil(Math.sqrt(n)),h=Array(d).fill(null);h.forEach(((o,c)=>{h.forEach(((o,h)=>{const l=r(2,10)*(s||n>=10&&c<.1*d?20:1)/2,a=r(2,10)*(s||n>=10&&h<.1*d?20:1)/2;i.rects.push([r(l,e-l),r(a,t-a),l,a])}))}));const c=performance.now();for(let e=0;e<i.rects.length;e++)o.insert(0,i.rects[e]);const l=performance.now();console.log(`add ${n} duration`,l-c),console.log("allNodes",o.nodeAnchor)}})();
//# sourceMappingURL=demo.bundle.js.map